<html>
<head>
		

		
		<!-- Jquery -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		
	<title>UPCL Chatbot</title>
	
	
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<script type="text/javascript">

		var accessToken = "f79640eac50e45eabe89a8e0c22ef8df";
		var baseUrl = "https://api.api.ai/v1/";
		var d = new Date();
		var h = d.getHours();
		var m = d.getMinutes();
	
	

		$(document).ready(function() {
			$("#input").keypress(function(event) {
				if (event.which == 13) {
					//  <div><p>Query</p><p {fontSize--, textAlign: right}>Timestamp</p></div>
					$('.chatBox').append('<div class="userInput">'+'<img class="userimage" src="avatar1.png">'  + '      ' + $('input').val()+'<br><br>'+'<div class = "usertime">'+h+":"+m+'</div>'+'</div>'+'</div>');
					
					$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
					event.preventDefault();
					let query  = $('input').val()
					$('input').val('')
					send(query);
				}
			});
		});
	  


		function send(query) {
			var text = query;
		
			$.ajax({
				type: "POST",
				url: baseUrl + "query?v=20180101",
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				headers: {
					"Authorization": "Bearer " + accessToken
				},
				data: JSON.stringify({ query: text, lang: "en", sessionId: "somerandomthing" }),
				success: function(data) {
					setResponse(data);
				}
			});
		}
		
		
		var idleInterval;
		function setResponse(val) {
			console.log(val.result.fulfillment.speech);
			if (val.result.fulfillment.speech=='Thank you for using UPCL'){
				$(".chatBox").append('<div class="responseData">'+'<img class="responseimage" src="avatar2.png">'+  '  Thank you for using UPCL'+'<br><br>'+'<div class = "responsetime">'+h+":"+m+'</div>'+'</div>');
		   	$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
				clearInterval(idleInterval);
			}
			else{
				
			$(".chatBox").append('<div class="responseData">'+'<img class="responseimage" src="avatar2.png">'+ '  ' + val.result.fulfillment.speech + '<br><br>'+'<div class = "responsetime">'+h+":"+m+'</div>'+'</div>');
			$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
		}
		}
			var idleTime = 0;

$(document).ready(function () {
    //Increment the idle time counter every sec.
    idleInterval = setInterval(timerIncrement, 1000); // 1 second

    //Zero the idle timer on mouse movement.
   // $(this).mousemove(function (e) {
     //   idleTime = 0;
   // });
    $(this).keypress(function (e) {
        idleTime = 0;
    });
});
		
function timerIncrement() {
	idleTime = idleTime + 1;
	
	console.log(idleTime);
  
    if (idleTime == 30) { // 20 sec
		$(".chatBox").append('<div class="responseData">'+'<img class="responseimage" src="avatar2.png">'+ '  Do you need any further assistance?(Yes/No)'+'<br><br>'+'<div class = "responsetime">'+h+":"+m+'</div>'+'</div>');
		$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
			
		}

		else if (idleTime == 50){
			$(".chatBox").append('<div class="responseData">'+'<img class="responseimage" src="avatar2.png">'+ '  Thank you for using UPCL'+'<br><br>'+'<div class = "responsetime">'+h+":"+m+'</div>'+'</div>');
			$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
			
			window.stop();
		}
}

function openForm() {
  document.getElementById("myForm").style.display = "block";
  
  $(".chatBox").append('<div class="responseData">'+'<img class="responseimage" src="avatar2.png">'+ '  How may I assist you today ?'+'<br><br>' +'<div class = "responsetime">'+h+":"+m+'</div>'+'</div>');	

	$(".chatBox").animate({ scrollTop: $('.chatBox').prop("scrollHeight")}, 800);
	
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
  $(".chatBox").empty();
}

	
	</script>
	<style type="text/css">
		body {font-family: Arial, Helvetica, sans-serif;height: 400px;}
* {box-sizing: border-box;}
		.chat-popup {
  display: none;
  position: fixed;
  bottom:10 px;
  right: 15px;
  border: 3px solid #f1f1f1;

}

.form-container {
  width: 400px;
  padding: 10px;
  background-color: white;
  height: 500px;
}

.form-container .btn:hover, .open-button:hover {
  opacity: 1;
}

.chatBox {
				overflow: auto;
				height: 350px;
				
			}
		
		.userInput{float:right;text-align:right;padding-left: 100px;width: 80%;margin: 6px ;;background: #1ddced;border-radius: 15px;color: #fff;padding: 5px;}
		
		
		.responseData{float:left; padding-right: 100px;width: 80%;margin: 6px ;background: #1adda4;border-radius: 15px;color: #fff;padding: 5px};
		#input { width: 600px; }

		.form-container .cancel {
  
  border-radius: 50%;
	margin: 10px;
	width: 50px;
	height: 50px;
	position:absolute;
	left: 40%;
	

}
.close-btn-img{
	height: 100%;
	width: 100%;
	
	box-shadow: #f1f1f1;
}
.userimage{
	height: 50px;
	width: 50px;
	margin-bottom: 10px;
	
	border-radius: 50%;
	float: right;
	
	
	
}
.responseimage{
	height:50px;
	width:50px;
	border-radius: 50%;
	margin-bottom: 10px;
	margin-right: 10px;
	float: left;
	
	
}
.open-button {
  padding: 16px 20px;
  cursor: pointer;
  opacity: 0.8;
  position:fixed;
  bottom: 23px;
  right: 50px;
	border-radius: 50%;
  height: 100px;
	width: 100px;
}	

.open-button-img {
	height: 100%;
	width: 100%;
	box-shadow: #f1f1f1;
	
}		
.usertime{
	
	font-size: 12px;
	padding-left: 30px;
	text-align: left;
	
}
.responsetime{
	text-align: right;
	font-size: 12px;
	padding-right: 30px;
	
}
header {
    background-color:#ECF3F3;
	margin-top: 0px;
}
</style>
</head>
<body>
	<button class="open-button" onclick="openForm()"><img class='open-button-img' src="ank2.png"></button>
	<div class="chat-popup" id="myForm">
		<header>
			<h1 >&nbsp; Hi, I am Shakti. &nbsp;<img src="upcl.png" style="width: 100px;height: 70px;border-radius: 55%"></h1>
			<h2>&nbsp;I am UPCLâ€™s digital assistant</h2>
		</header>	
		<div class="form-container">
	<div class = 'chatBox'>
		
	</div>
	
  
	
	<input id="input" type="text" style="width: 380px;border-radius: 15px;height: 35px;" placeholder="Write your message here..." > 
	<button type="button" class="btn cancel" onclick="closeForm()"><img class = 'close-btn-img' src="close.png"></button>
  </div>
</div>

</body>
</html>